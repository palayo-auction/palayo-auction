<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Firebase Web Push Test</title>
</head>
<body>
<h1>FCM Web Push í…ŒìŠ¤íŠ¸ ðŸš€</h1>
<button onclick="requestPermission()">ì•Œë¦¼ í—ˆìš©</button>

<!-- âœ… Firebase SDK (v9 ì´ìƒ "compat" ë²„ì „ ì‚¬ìš©) -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-messaging-compat.js"></script>

<script>
    // âœ… Firebase ì„¤ì •
    const firebaseConfig = {
        apiKey: "AIzaSyBzZZDBwYnhAt6Vik-u-Q69p-yLb3FRhxo",
        authDomain: "palayo-auction-test.firebaseapp.com",
        projectId: "palayo-auction-test",
        storageBucket: "palayo-auction-test.firebasestorage.app",
        messagingSenderId: "841013647267",
        appId: "1:841013647267:web:f4dc5f7db738245e846c16"
    };

    // âœ… Firebase ì´ˆê¸°í™”
    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    // âœ… ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ (ëª…ì‹œì ìœ¼ë¡œ ì§€ì •)
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/firebase-messaging-sw.js')
            .then((registration) => {
                console.log("âœ… ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì™„ë£Œ:", registration);

                // âœ… FCM í† í° ê°€ì ¸ì˜¤ê¸° (ë“±ë¡í•œ ì„œë¹„ìŠ¤ ì›Œì»¤ ì‚¬ìš©)
                messaging.getToken({ vapidKey: "BHMfUs8NxE6H71mH3R2kxWcct7KiY4KFm6_efcyN5awWsLdLSfK4C-l4VNpqF0Q6Sp07mBKRxLX6PfrCEN_mrjU", serviceWorkerRegistration: registration })
                    .then((token) => {
                        if (token) {
                            console.log("ðŸ“¢ FCM Token:", token);

                            // âœ… ì„œë²„ë¡œ FCM í† í° ì „ì†¡
                            fetch("http://localhost:8080/api/notification/register", {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({ token: token })
                            });
                        } else {
                            console.log("âŒ í† í°ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ");
                        }
                    })
                    .catch((error) => {
                        console.error("âŒ FCM í† í° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error);
                    });

            })
            .catch(err => console.error("âŒ ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡ ì‹¤íŒ¨:", err));
    }

    // âœ… ì•Œë¦¼ ê¶Œí•œ ìš”ì²­ í•¨ìˆ˜
    function requestPermission() {
        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                console.log("âœ… ì•Œë¦¼ ê¶Œí•œ í—ˆìš©ë¨");
            } else {
                console.error("âŒ ì•Œë¦¼ ê¶Œí•œ ê±°ë¶€ë¨");
            }
        });
    }

    // âœ… í¬ê·¸ë¼ìš´ë“œ í‘¸ì‹œ ë©”ì‹œì§€ ìˆ˜ì‹ 
    messaging.onMessage(payload => {
        console.log("ðŸ“© ë©”ì‹œì§€ ìˆ˜ì‹ :", payload);
        alert(`ì•Œë¦¼: ${payload.notification.title} - ${payload.notification.body}`);
    });

</script>
</body>
</html>
